<?php

//////////////////////////////////////////////////////////////////////////////80
// Settings Controller
//////////////////////////////////////////////////////////////////////////////80
// Copyright (c) Atheos & Liam Siira (Atheos.io), distributed as-is and without
// warranty under the modified License: MIT - Hippocratic 1.2: firstdonoharm.dev
// See [root]/license.md for more. This information must remain intact.
//////////////////////////////////////////////////////////////////////////////80
// Authors: Codiad Team, @Fluidbyte, Atheos Team, @hlsiira
//////////////////////////////////////////////////////////////////////////////80

require_once('../../common.php');
require_once('class.settings.php');

//////////////////////////////////////////////////////////////////////////////80
// Verify Session or Key
//////////////////////////////////////////////////////////////////////////////80
Common::checkSession();

$action = Common::data("action");
$activeUser = Common::data("user", "session");

if (!$action) {
	Common::sendJSON("E401m");
	die;
}

$Settings = new Settings();

switch ($action) {

	//////////////////////////////////////////////////////////////////////////80
	// Load User Settings
	//////////////////////////////////////////////////////////////////////////80
	case "load":
		$Settings->username = $activeUser;
		$Settings->load();
		break;

	//////////////////////////////////////////////////////////////////////////80
	// Save User Settings
	//////////////////////////////////////////////////////////////////////////80
	case "save":
		$key = Common::data("key");
		$value = Common::data("value");
		if ($key && $value) {
			$Settings->username = $activeUser;
			$Settings->save($key, $value);
		} else {
			Common::sendJSON("E403g");
		}
		break;

	//////////////////////////////////////////////////////////////////////////80
	// Default: Invalid Action
	//////////////////////////////////////////////////////////////////////////80
	default:
		Common::sendJSON("E401i");
		break;
}