<?php

//////////////////////////////////////////////////////////////////////////////80
// Update Controller
//////////////////////////////////////////////////////////////////////////////80
// Copyright (c) Atheos & Liam Siira (Atheos.io), distributed as-is and without
// warranty under the modified License: MIT - Hippocratic 1.2: firstdonoharm.dev
// See [root]/license.md for more. This information must remain intact.
//////////////////////////////////////////////////////////////////////////////80
// Authors: Codiad Team, @Fluidbyte, Atheos Team, @hlsiira
//////////////////////////////////////////////////////////////////////////////80

require_once('../../common.php');
require_once('class.update.php');

//////////////////////////////////////////////////////////////////////////////80
// Verify Session or Key
//////////////////////////////////////////////////////////////////////////////80
Common::checkSession();

$action = Common::data("action");

if (!$action) {
	Common::sendJSON("error", "Missing Action");
	die;
}

$update = new Update();

switch ($action) {

	//////////////////////////////////////////////////////////////////////////80
	// Check for an Update
	//////////////////////////////////////////////////////////////////////////80
	case 'check':
		$update->check();
		break;

	//////////////////////////////////////////////////////////////////////////80
	// Initialize the Update Modules
	//////////////////////////////////////////////////////////////////////////80
	case 'init':
		$update->init();
		break;

	//////////////////////////////////////////////////////////////////////////80
	// Load Local Data
	//////////////////////////////////////////////////////////////////////////80
	case 'load':
		$update->getLocalData();
		break;

	//////////////////////////////////////////////////////////////////////////80
	// OptIn to Athoes Analytics
	//////////////////////////////////////////////////////////////////////////80
	case 'optin':
		if (Common::checkAccess("configure")) {
			$update->optIn();
		}
		break;

	//////////////////////////////////////////////////////////////////////////80
	// OptOut of Athoes Analytics
	//////////////////////////////////////////////////////////////////////////80
	case 'optout':
		if (Common::checkAccess("configure")) {
			$update->optOut();
		}
		break;

	//////////////////////////////////////////////////////////////////////////80
	// Save Local Data
	//////////////////////////////////////////////////////////////////////////80
	case 'save':
		$update->setLocalData();
		break;


	//////////////////////////////////////////////////////////////////////////80
	// Default: Invalid Action
	//////////////////////////////////////////////////////////////////////////80
	default:
		Common::sendJSON("E401i");
		break;
}