// Creation Time: 2020-03-16 15:03:14
// components/active/init.js
// components/active/init.js
(function(global,$){var ace=global.ace,amplify=global.amplify;var EditSession=ace.require('ace/edit_session').EditSession;var UndoManager=ace.require('ace/undomanager').UndoManager;var codiad=global.codiad;amplify.subscribe('atheos.loaded',()=>atheos.active.init());codiad.active={controller:'components/active/controller.php',sessions:{},history:[],isOpen:function(path){return!!this.sessions[path]},open:function(path,content,mtime,inBackground,focus){if(focus===undefined){focus=!0}
var _this=this;if(this.isOpen(path)){if(focus)this.focus(path);return}
var ext=codiad.common.getNodeExtension(path);var mode=codiad.editor.selectMode(ext);var fn=function(){var draft=_this.checkDraft(path);if(draft){content=draft;codiad.toast.success('Recovered unsaved content for: '+path)}
var session=new EditSession(content);session.setMode("ace/mode/"+mode);session.setUndoManager(new UndoManager());session.path=path;session.serverMTime=mtime;_this.sessions[path]=session;session.untainted=content.slice(0);if(!inBackground&&focus){codiad.editor.setSession(session)}
_this.add(path,session,focus);amplify.publish('active.onOpen',path)};codiad.common.loadScript('components/editor/ace-editor/mode-'+mode+'.js',fn)},init:function(){var _this=this;_this.initTabDropdownMenu();_this.updateTabDropdownVisibility();$('#list-active-files a').live('click',function(e){e.stopPropagation();_this.focus($(this).parent('li').attr('data-path'))});$('#dropdown-list-active-files a').live('click',function(e){if(e.which==1){_this.focus($(this).parent('li').attr('data-path'))}});$('#tab-list-active-files li.tab-item>a.label').live('mousedown',function(e){if(e.which==1){e.stopPropagation();_this.focus($(this).parent('li').attr('data-path'))}});$('#list-active-files a>span').live('click',function(e){e.stopPropagation();_this.remove($(this).parent('a').parent('li').attr('data-path'))});$('#dropdown-list-active-files a>span').live('click',function(e){e.stopPropagation();var activePath=_this.getPath();var pathToRemove=$(this).parents('li').attr('data-path');_this.remove(pathToRemove);if(activePath!==null&&activePath!==pathToRemove){_this.focus(activePath)}
_this.updateTabDropdownVisibility()});$('#tab-list-active-files a.close').live('click',function(e){e.stopPropagation();var activePath=_this.getPath();var pathToRemove=$(this).parent('li').attr('data-path');_this.remove(pathToRemove);if(activePath!==null&&activePath!==pathToRemove){_this.focus(activePath)}
_this.updateTabDropdownVisibility()});$('#dropdown-list-active-files li').live('mouseup',function(e){if(e.which==2){e.stopPropagation();var activePath=_this.getPath();var pathToRemove=$(this).attr('data-path');_this.remove(pathToRemove);if(activePath!==null&&activePath!==pathToRemove){_this.focus(activePath)}
_this.updateTabDropdownVisibility()}});$('.tab-item').live('mouseup',function(e){if(e.which==2){e.stopPropagation();var activePath=_this.getPath();var pathToRemove=$(this).attr('data-path');_this.remove(pathToRemove);if(activePath!==null&&activePath!==pathToRemove){_this.focus(activePath)}
_this.updateTabDropdownVisibility()}});$('#list-active-files').sortable({placeholder:'active-sort-placeholder',tolerance:'intersect',start:function(e,ui){ui.placeholder.height(ui.item.height())}});$('#dropdown-list-active-files').sortable({axis:'y',tolerance:'pointer',start:function(e,ui){ui.placeholder.height(ui.item.height())}});$('#tab-list-active-files').sortable({items:'> li',axis:'x',tolerance:'pointer',containment:'parent',start:function(e,ui){ui.placeholder.css('background','transparent');ui.helper.css('width','200px')},stop:function(e,ui){ui.item.css('z-index','');ui.item.css('position','')}});$('#tab-list-active-files').data('sortable').floating=!0;$.get(_this.controller+'?action=list',function(data){var listResponse=codiad.jsend.parse(data);if(listResponse!==null){$.each(listResponse,function(index,data){codiad.filemanager.openFile(data.path,data.focused)})}});window.onbeforeunload=function(e){if($('#list-active-files li.changed').length>0){e=e||window.event;var errMsg='You have unsaved files.';if(e){e.returnValue=errMsg}
return errMsg}};amplify.subscribe('chrono.mega',function(){$('#active-files a.changed').each(function(){var path=$(this).attr('data-path');var content=codiad.active.sessions[path].getValue();localStorage.setItem(path,content)})})},checkDraft:function(path){var draft=localStorage.getItem(path);if(draft!==null){return draft}else{return!1}},removeDraft:function(path){localStorage.removeItem(path)},getPath:function(){try{return codiad.editor.getActive().getSession().path}catch(e){return null}},check:function(path){$.get(this.controller+'?action=check&path='+encodeURIComponent(path),function(data){codiad.jsend.parse(data)})},add:function(path,session,focus){if(focus===undefined){focus=!0}
var listThumb=this.createListThumb(path);session.listThumb=listThumb;$('#list-active-files').append(listThumb);if(this.isTabListOverflowed(!0)){var tab=$('#tab-list-active-files li:first-child');this.moveTabToDropdownMenu(tab)}
var tabThumb=this.createTabThumb(path);$('#tab-list-active-files').append(tabThumb);session.tabThumb=tabThumb;this.updateTabDropdownVisibility();$.get(this.controller+'?action=add&path='+encodeURIComponent(path));if(focus){this.focus(path)}
if(this.checkDraft(path)){this.markChanged(path)}},focus:function(path,moveToTabList){if(moveToTabList===undefined){moveToTabList=!0}
this.highlightEntry(path,moveToTabList);if(path!=this.getPath()){codiad.editor.setSession(this.sessions[path]);this.history.push(path);$.get(this.controller,{'action':'focused','path':path})}
this.check(path);amplify.publish('active.onFocus',path)},highlightEntry:function(path,moveToTabList){if(moveToTabList===undefined){moveToTabList=!0}
$('#list-active-files li').removeClass('active');$('#tab-list-active-files li').removeClass('active');$('#dropdown-list-active-files li').removeClass('active');var session=this.sessions[path];if($('#dropdown-list-active-files').has(session.tabThumb).length>0){if(moveToTabList){var menuItem=session.tabThumb;this.moveDropdownMenuItemToTab(menuItem,!0);var tab=$('#tab-list-active-files li:last-child');this.moveTabToDropdownMenu(tab)}else{this.showTabDropdownMenu()}}else if(this.history.length>0){var prevPath=this.history[this.history.length-1];var prevSession=this.sessions[prevPath];if($('#dropdown-list-active-files').has(prevSession.tabThumb).length>0){this.hideTabDropdownMenu()}}
session.tabThumb.addClass('active');session.listThumb.addClass('active')},markChanged:function(path){this.sessions[path].listThumb.addClass('changed');this.sessions[path].tabThumb.addClass('changed')},save:function(path){amplify.publish('active.onSave',path);var _this=this;if((path&&!this.isOpen(path))||(!path&&!codiad.editor.getActive())){codiad.toast.error('No Open Files to save');return}
var session;if(path){session=this.sessions[path]}else{session=codiad.editor.getActive().getSession()}
var content=session.getValue();path=session.path;var handleSuccess=function(mtime){var session=codiad.active.sessions[path];if(typeof session!=='undefined'){session.untainted=newContent;session.serverMTime=mtime;if(session.listThumb)session.listThumb.removeClass('changed');if(session.tabThumb)session.tabThumb.removeClass('changed')}
_this.removeDraft(path)};var newContent=content.slice(0);if(session.serverMTime&&session.untainted){codiad.workerManager.addTask({taskType:'diff',id:path,original:session.untainted,changed:newContent},function(success,patch){if(success){codiad.filemanager.savePatch(path,patch,session.serverMTime,{success:handleSuccess})}else{codiad.filemanager.saveFile(path,newContent,{success:handleSuccess})}},this)}else{codiad.filemanager.saveFile(path,newContent,{success:handleSuccess})}},saveAll:function(){for(var session in this.sessions){if(this.sessions[session].listThumb.hasClass('changed')){codiad.active.save(session)}}},remove:function(path){if(!this.isOpen(path))return;var session=this.sessions[path];var closeFile=!0;if(session.listThumb.hasClass('changed')){codiad.modal.load(450,'components/active/dialog.php?action=confirm&path='+encodeURIComponent(path));closeFile=!1}
if(closeFile){this.close(path)}},removeAll:function(discard){discard=discard||!1;amplify.publish('active.onRemoveAll');var _this=this;var changed=!1;var opentabs=[];for(var session in _this.sessions){opentabs[session]=session;if(_this.sessions[session].listThumb.hasClass('changed')){changed=!0}}
if(changed&&!discard){codiad.modal.load(450,'components/active/dialog.php?action=confirmAll');return}
for(var tab in opentabs){var session=this.sessions[tab];session.tabThumb.remove();_this.updateTabDropdownVisibility();session.listThumb.remove();var history=[];$.each(this.history,function(index){if(this!=tab)history.push(this)});this.history=history;delete this.sessions[tab];this.removeDraft(tab)}
codiad.editor.exterminate();$('#list-active-files').html('');$.get(this.controller+'?action=removeall')},close:function(path){amplify.publish('active.onClose',path);var _this=this;var session=this.sessions[path];if(session.tabThumb.hasClass('tab-item')){session.tabThumb.css({'z-index':1});session.tabThumb.animate({top:$('#editor-top-bar').height()+'px'},300,function(){session.tabThumb.remove();_this.updateTabDropdownVisibility()})}else{session.tabThumb.remove();_this.updateTabDropdownVisibility()}
session.listThumb.remove();var history=[];$.each(this.history,function(index){if(this!=path)history.push(this)});this.history=history;var tabThumbs=$('#tab-list-active-files li[data-path!="'+path+'"]');if(tabThumbs.length==0){codiad.editor.exterminate()}else{var nextPath='';if(this.history.length>0){nextPath=this.history[this.history.length-1]}else{nextPath=$(tabThumbs[0]).attr('data-path')}
var nextSession=this.sessions[nextPath];codiad.editor.removeSession(session,nextSession);this.focus(nextPath)}
delete this.sessions[path];$.get(this.controller+'?action=remove&path='+encodeURIComponent(path));this.removeDraft(path)},rename:function(oldPath,newPath){var switchSessions=function(oldPath,newPath){var tabThumb=this.sessions[oldPath].tabThumb;tabThumb.attr('data-path',newPath);var title=newPath;if(codiad.project.isAbsPath(newPath)){title=newPath.substring(1)}
tabThumb.find('.label').text(title);this.sessions[newPath]=this.sessions[oldPath];this.sessions[newPath].path=newPath;delete this.sessions[oldPath];for(var i=0;i<this.history.length;i++){if(this.history[i]===oldPath){this.history[i]=newPath}}};if(this.sessions[oldPath]){switchSessions.apply(this,[oldPath,newPath]);for(var k=0;k<codiad.editor.instances.length;k++){if(codiad.editor.instances[k].getSession().path===newPath){codiad.editor.setActive(codiad.editor.instances[k])}}
var newSession=this.sessions[newPath];var ext=codiad.common.getNodeExtension(newPath);var mode=codiad.editor.selectMode(ext);var fn=function(){codiad.editor.setModeDisplay(newSession);newSession.removeListener('changeMode',fn)}
newSession.on("changeMode",fn);newSession.setMode("ace/mode/"+mode)}else{var newKey;for(var key in this.sessions){newKey=key.replace(oldPath,newPath);if(newKey!==key){switchSessions.apply(this,[key,newKey])}}}
$.get(this.controller+'?action=rename&old_path='+encodeURIComponent(oldPath)+'&new_path='+encodeURIComponent(newPath),function(){amplify.publish('active.onRename',{"oldPath":oldPath,"newPath":newPath})})},openInBrowser:function(){var path=this.getPath();if(path){codiad.filemanager.openInBrowser(path)}else{codiad.toast.error('No Open Files')}},getSelectedText:function(){var path=this.getPath();var session=this.sessions[path];if(path&&this.isOpen(path)){return session.getTextRange(codiad.editor.getActive().getSelectionRange())}else{codiad.toast.error('No Open Files or Selected Text')}},insertText:function(val){codiad.editor.getActive().insert(val)},gotoLine:function(line){codiad.editor.getActive().gotoLine(line,0,!0)},move:function(dir){var num=$('#tab-list-active-files li').length;if(num===0)return;var newActive=null;var active=null;if(dir=='up'){active=$('#tab-list-active-files li.active');if(active.length>0){newActive=active.prev('li');if(newActive.length===0){newActive=$('#dropdown-list-active-files li:last-child');if(newActive.length===0){newActive=$('#tab-list-active-files li:last-child')}}}
active=$('#dropdown-list-active-files li.active');if(active.length>0){newActive=active.prev('li');if(newActive.length===0){newActive=$('#tab-list-active-files li:last-child')}}}else{active=$('#tab-list-active-files li.active');if(active.length>0){newActive=active.next('li');if(newActive.length===0){newActive=$('#dropdown-list-active-files li:first-child');if(newActive.length===0){newActive=$('#tab-list-active-files li:first-child')}}}
active=$('#dropdown-list-active-files li.active');if(active.length>0){newActive=active.next('li');if(newActive.length===0){newActive=$('#tab-list-active-files li:first-child')}}}
if(newActive)this.focus(newActive.attr('data-path'),!1)},initTabDropdownMenu:function(){var _this=this;var menu=$('#dropdown-list-active-files');var button=$('#tab-dropdown-button');var closebutton=$('#tab-close-button');menu.appendTo($('body'));button.click(function(e){e.stopPropagation();_this.toggleTabDropdownMenu()});closebutton.click(function(e){e.stopPropagation();_this.removeAll()})},showTabDropdownMenu:function(){var menu=$('#dropdown-list-active-files');if(!menu.is(':visible'))this.toggleTabDropdownMenu()},hideTabDropdownMenu:function(){var menu=$('#dropdown-list-active-files');if(menu.is(':visible'))this.toggleTabDropdownMenu()},toggleTabDropdownMenu:function(){var menu=$('#dropdown-list-active-files');menu.css({top:$("#editor-top-bar").height()+1+'px',right:'22px',width:'300px'});menu.slideToggle('fast');if(menu.is(':visible')){var fn=function(){menu.hide();$(window).off('click',fn)};$(window).on('click',fn)}},moveTabToDropdownMenu:function(tab,prepend){if(prepend===undefined){prepend=!1}
tab.remove();var path=tab.attr('data-path');var tabThumb=this.createMenuItemThumb(path);if(prepend)$('#dropdown-list-active-files').prepend(tabThumb);else $('#dropdown-list-active-files').append(tabThumb);if(tab.hasClass("changed")){tabThumb.addClass("changed")}
if(tab.hasClass("active")){tabThumb.addClass("active")}
this.sessions[path].tabThumb=tabThumb},moveDropdownMenuItemToTab:function(menuItem,prepend){if(prepend===undefined){prepend=!1}
menuItem.remove();var path=menuItem.attr('data-path');var tabThumb=this.createTabThumb(path);if(prepend)$('#tab-list-active-files').prepend(tabThumb);else $('#tab-list-active-files').append(tabThumb);if(menuItem.hasClass("changed")){tabThumb.addClass("changed")}
if(menuItem.hasClass("active")){tabThumb.addClass("active")}
this.sessions[path].tabThumb=tabThumb},isTabListOverflowed:function(includeFictiveTab){if(includeFictiveTab===undefined){includeFictiveTab=!1}
var tabs=$('#tab-list-active-files li');var count=tabs.length;if(includeFictiveTab)count+=1;if(count<=1)return!1;var width=0;tabs.each(function(index){width+=$(this).outerWidth(!0)});if(includeFictiveTab){width+=$(tabs[tabs.length-1]).outerWidth(!0)}
var lsbarWidth=$(".sidebar-handle").width();if(codiad.sidebars.settings.isLeftSidebarOpen){lsbarWidth=$("#sb-left").width()}
var rsbarWidth=$(".sidebar-handle").width();if(codiad.sidebars.settings.isRightSidebarOpen){rsbarWidth=$("#sb-right").width()}
var dropdownWidth=$('#tab-dropdown').width();var closeWidth=$('#tab-close').width();var room=window.innerWidth-lsbarWidth-rsbarWidth-dropdownWidth-closeWidth-width-40;return(room<0)},updateTabDropdownVisibility:function(){while(this.isTabListOverflowed()){var tab=$('#tab-list-active-files li:last-child');if(tab.length==1)this.moveTabToDropdownMenu(tab,!0);else break}
while(!this.isTabListOverflowed(!0)){var menuItem=$('#dropdown-list-active-files li:first-child');if(menuItem.length==1)this.moveDropdownMenuItemToTab(menuItem);else break}
if($('#dropdown-list-active-files li').length>0){$('#tab-dropdown').show()}else{$('#tab-dropdown').hide();$('#dropdown-list-active-files').hide()}
if($('#tab-list-active-files li').length>1){$('#tab-close').show()}else{$('#tab-close').hide()}},splitDirectoryAndFileName:function(path){var index=path.lastIndexOf('/');return{fileName:path.substring(index+1),directory:(path.indexOf('/')==0)?path.substring(1,index+1):path.substring(0,index+1)}},createListThumb:function(path){return $('<li data-path="'+path+'"><a title="'+path+'"><span></span><div>'+path+'</div></a></li>')},createTabThumb:function(path){var split=this.splitDirectoryAndFileName(path);return $('<li class="tab-item" data-path="'+path+'"><a class="label" title="'+path+'">'+split.directory+'<span class="file-name">'+split.fileName+'</span>'+'</a><a class="close"></a></li>')},createMenuItemThumb:function(path){var split=this.splitDirectoryAndFileName(path);return $('<li data-path="'+path+'"><a title="'+path+'"><span class="label"></span><div class="label">'+split.directory+'<span class="file-name">'+split.fileName+'</span>'+'</div></a></li>')},}})(this,jQuery);
// components/contextmenu/init.js
// components/contextmenu/init.js
(function(global,$){var atheos=global.atheos,amplify=global.amplify,o=global.onyx;amplify.subscribe('atheos.loaded',()=>atheos.contextmenu.init());atheos.contextmenu={noOpen:['jpg','jpeg','png','gif','bmp','exe','zip','tar','tar.gz'],noBrowser:['jpg','jpeg','png','gif','bmp'],controller:'components/filemanager/controller.php',dialog:'components/filemanager/dialog.php',dialogUpload:'components/filemanager/dialog_upload.php',contextMenu:{},init:function(){var checkAnchor=function(node){node=o(node);var tagName=node.el.tagName;if(tagName==='UL'){return!1}else if(tagName!=='A'){if(tagName==='LI'){node=node.find('a')[0]}else{node=o(node.parent())}}
return node};o('#file-manager').on('contextmenu',function(e){e.preventDefault();atheos.contextmenu.show(e,checkAnchor(e.target))})},show:function(e,node){if(node){var path=node.attr('data-path'),type=node.attr('data-type'),name=node.find('span')[0].html();node.addClass('context-menu-active');switch(type){case 'directory':$('#context-menu .directory-only, #context-menu .non-root').show();$('#context-menu .file-only, #context-menu .root-only').hide();break;case 'file':$('#context-menu .directory-only, #context-menu .root-only').hide();$('#context-menu .file-only,#context-menu .non-root').show();break;case 'root':$('#context-menu .directory-only, #context-menu .root-only').show();$('#context-menu .non-root, #context-menu .file-only').hide();break}
if(atheos.project.isAbsPath(o('#file-manager a[data-type="root"]').attr('data-path'))){$('#context-menu .no-external').hide()}else{$('#context-menu .no-external').show()}
var top=e.pageY;if(top>$(window).height()-$('#context-menu').height()){top-=$('#context-menu').height()}
if(top<10){top=10}
var max=$(window).height()-top-10;var menu=o('#context-menu');menu.css({'top':top+'px','left':e.pageX+'px','max-height':max+'px','display':'block'});menu.attr('data-path',path);menu.attr('data-type',type);menu.attr('data-name',name);if(this.clipboard===''){$('#context-menu a[content="Paste"]').addClass('disabled')}else{$('#context-menu a[data-action="paste"]').removeClass('disabled')}
var contextMenu=this;var hideContextMenu;o('#context-menu').on('mouseout',function(){hideContextMenu=setTimeout(function(){contextMenu.hide()},500)});o('#context-menu').on('mouseover',function(){if(hideContextMenu){clearTimeout(hideContextMenu)}});amplify.publish('contextmenu.show',{path:path,type:type});o('#context-menu').on('click',function(){contextMenu.hide()})}},hide:function(){o('#context-menu').hide();var active=o('#file-manager a.context-menu-active');if(active){active.removeClass('context-menu-active')}
amplify.publish('contextmenu.hide')},getType:function(path){return o('#file-manager a[data-path="'+path+'"]').attr('data-type')},uploadToNode:function(path){atheos.modal.load(500,this.dialogUpload,{path:path})},download:function(path){var type=this.getType(path);o('#download').attr('src','components/filemanager/download.php?path='+encodeURIComponent(path)+'&type='+type)}}})(this,jQuery);
// components/editor/init.js
// components/editor/init.js
(function(global,$){var VirtualRenderer=ace.require('ace/virtual_renderer').VirtualRenderer;var Editor=ace.require('ace/editor').Editor;var EditSession=ace.require('ace/edit_session').EditSession;var UndoManager=ace.require('ace/undomanager').UndoManager;var editorModes={};var codiad=global.codiad;var separatorWidth=3;$(function(){codiad.editor.init()});var availableTextModes=new Array('abap','abc','actionscript','ada','apache_conf','applescript','asciidoc','assembly_x86','autohotkey','batchfile','c9search','c_cpp','cirru','clojure','cobol','coffee','coldfusion','csharp','css','curly','d','dart','diff','django','dockerfile','dot','eiffel','ejs','elixir','elm','erlang','forth','ftl','gcode','gherkin','gitignore','glsl','gobstones','golang','groovy','haml','handlebars','haskell','haxe','html','html_elixir','html_ruby','ini','io','jack','jade','java','javascript','json','jsoniq','jsp','jsx','julia','latex','lean','less','liquid','lisp','livescript','logiql','lsl','lua','luapage','lucene','makefile','markdown','mask','matlab','maze','mel','mips_assembler','mushcode','mysql','nix','nsis','objectivec','ocaml','pascal','perl','pgsql','php','plain_text','powershell','praat','prolog','protobuf','python','r','razor','rdoc','rhtml','rst','ruby','rust','sass','scad','scala','scheme','scss','sh','sjs','smarty','snippets','soy_template','space','sql','sqlserver','stylus','svg','swift','swig','tcl','tex','text','textile','toml','twig','typescript','vala','vbscript','velocity','verilog','vhdl','wollok','xml','xquery','yaml');function SplitContainer(root,children,splitType){var _this=this;this.root=root;this.splitType=splitType;this.childContainers={};this.childElements={};this.splitProp=0.5;this.setChild(0,children[0]);this.setChild(1,children[1]);this.splitter=$('<div>').addClass('splitter').appendTo(root).draggable({axis:(splitType==='horizontal'?'x':'y'),drag:function(e,ui){if(_this.splitType==='horizontal'){var w1,w2;w1=ui.position.left-separatorWidth/2;w2=_this.root.width()-ui.position.left-separatorWidth/2;_this.splitProp=w1/_this.root.width();_this.childElements[0].width(w1).trigger('h-resize',[!0,!0]);_this.childElements[1].width(w2).css('left',w1+separatorWidth+'px').trigger('h-resize',[!0,!0]);_this.splitProp=ui.position.left/_this.root.width()}else{var h1,h2;h1=ui.position.top-separatorWidth/2;h2=_this.root.width()-ui.position.top-separatorWidth/2;_this.splitProp=h1/_this.root.height();_this.childElements[0].height(h1).trigger('v-resize',[!0,!0]);_this.childElements[1].height(h2).css('top',h1+separatorWidth+'px').trigger('v-resize',[!0,!0])}}});if(splitType==='horizontal'){this.splitter.addClass('h-splitter').width(separatorWidth).height(root.height())}else if(splitType==='vertical'){this.splitter.addClass('v-splitter').height(separatorWidth).width(root.width())}
this.root.on('h-resize',function(e,percolateUp,percolateDown){e.stopPropagation();if(_this.splitType==='horizontal'){var w1,w2;w1=_this.root.width()*_this.splitProp-separatorWidth/2;w2=_this.root.width()*(1-_this.splitProp)-separatorWidth/2;_this.childElements[0].width(w1);_this.childElements[1].width(w2).css('left',w1+separatorWidth);_this.splitter.css('left',w1)}else if(_this.splitType==='vertical'){var w=_this.root.width();_this.childElements[0].width(w);_this.childElements[1].width(w);_this.splitter.width(w)}
if(percolateUp){_this.root.parent('.editor-wrapper').trigger('h-resize',[!0,!1])}
if(!percolateDown)return;if(_this.childContainers[0]){_this.childContainers[0].root.trigger('h-resize',[!1,!0])}else if(_this.childContainers[1]){_this.childContainers[1].root.trigger('h-resize',[!1,!0])}});this.root.on('v-resize',function(e,percolateUp,percolateDown){e.stopPropagation();if(_this.splitType==='horizontal'){var h=_this.root.height();_this.childElements[0].height(h);_this.childElements[1].height(h);_this.splitter.height(h)}else if(_this.splitType==='vertical'){var h1=_this.root.height()*_this.splitProp-separatorWidth/2;var h2=_this.root.height()*(1-_this.splitProp)-separatorWidth/2;_this.childElements[0].height(h1);_this.childElements[1].height(h2).css('top',h1+separatorWidth);_this.splitter.css('top',h1)}
if(percolateUp){_this.root.parent('.editor-wrapper').trigger('v-resize',[!0,!1])}
if(!percolateDown)return;if(_this.childContainers[0]){_this.childContainers[0].root.trigger('v-resize',[!1,!0])}else if(_this.childContainers[1]){_this.childContainers[1].root.trigger('v-resize',[!1,!0])}});this.root.trigger('h-resize',[!1,!1]).trigger('v-resize',[!1,!1])}
SplitContainer.prototype={setChild:function(idx,el){if(el instanceof SplitContainer){this.childElements[idx]=el.root;this.childContainers[idx]=el;el.idx=idx}else{this.childElements[idx]=el}
this.childElements[idx].appendTo(this.root);this.cssInit(this.childElements[idx],idx)},cssInit:function(el,idx){var props={};var h1,h2,w1,w2,rh,rw;rh=this.root.height();rw=this.root.width();if(this.splitType==='horizontal'){w1=rw*this.splitProp-separatorWidth/2;w2=rw*(1-this.splitProp)-separatorWidth/2;if(idx===0){props={left:0,width:w1,height:rh,top:0}}else{props={left:w1+separatorWidth,width:w2,height:rh,top:0}}}else if(this.splitType==='vertical'){h1=rh*this.splitProp-separatorWidth/2;h2=rh*(1-this.splitProp)-separatorWidth/2;if(idx===0){props={top:0,height:h1,width:rw,left:0}}else{props={top:h1+separatorWidth,height:h2,width:rw,left:0}}}
el.css(props)}};codiad.editor={instances:[],activeInstance:null,settings:{theme:'atheos',fontSize:'13px',printMargin:!1,printMarginColumn:80,highlightLine:!0,indentGuides:!0,wrapMode:!1,softTabs:!1,persistentModal:!0,fileManagerTrigger:!1,tabSize:4},rootContainer:null,fileExtensionTextMode:{},init:function(){this.createSplitMenu();this.createModeMenu();this.cursorTracking();var er=$('#editor-region');er.on('h-resize-init',function(){$('#editor-region > .editor-wrapper').width($(this).width()).trigger('h-resize')}).on('v-resize-init',function(){$('#editor-region > .editor-wrapper').height($(this).height()).trigger('v-resize')});$(window).resize(function(){$('#editor-region').trigger('h-resize-init').trigger('v-resize-init')})},getSettings:function(){var boolVal=null;var theme=localStorage.getItem('codiad.editor.theme');var _this=this;$.each(['theme','fontSize','tabSize'],function(idx,key){var localValue=localStorage.getItem('codiad.editor.'+key);if(localValue!==null){_this.settings[key]=localValue}});$.each(['printMargin','highlightLine','indentGuides','wrapMode','fileManagerTrigger','softTabs','persistentModal'],function(idx,key){var localValue=localStorage.getItem('codiad.editor.'+key);if(localValue===null){return}
_this.settings[key]=(localValue=='true')});$.each(['printMarginColumn'],function(idx,key){var localValue=localStorage.getItem('codiad.editor.'+key);if(localValue===null){return}
_this.settings[key]=localValue})},applySettings:function(i){this.getSettings();i.setTheme('ace/theme/'+this.settings.theme);i.setOptions({fontFamily:'Ubuntu-Fira',enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1});i.setFontSize(this.settings.fontSize);i.setPrintMarginColumn(this.settings.printMarginColumn);i.setShowPrintMargin(this.settings.printMargin);i.setHighlightActiveLine(this.settings.highlightLine);i.setDisplayIndentGuides(this.settings.indentGuides);i.getSession().setUseWrapMode(this.settings.wrapMode);this.setTabSize(this.settings.tabSize,i);this.setSoftTabs(this.settings.softTabs,i)},addInstance:function(session,where){var el=$('<div class="editor">');var chType,chArr=[],sc=null,chIdx=null;var _this=this;if(this.instances.length==0){el.appendTo($('#root-editor-wrapper'))}else{var ch=this.activeInstance.el;var root;chIdx=(where==='top'||where==='left')?0:1;chType=(where==='top'||where==='bottom')?'vertical':'horizontal';chArr[chIdx]=el;chArr[1-chIdx]=ch;root=$('<div class="editor-wrapper">').height(ch.height()).width(ch.width()).addClass('editor-wrapper-'+chType).appendTo(ch.parent());sc=new SplitContainer(root,chArr,chType);if(this.instances.length>1){var pContainer=this.activeInstance.splitContainer;var idx=this.activeInstance.splitIdx;pContainer.setChild(idx,sc)}}
var i=ace.edit(el[0]);var resizeEditor=function(){i.resize()};if(sc){i.splitContainer=sc;i.splitIdx=chIdx;this.activeInstance.splitContainer=sc;this.activeInstance.splitIdx=1-chIdx;sc.root.on('h-resize',resizeEditor).on('v-resize',resizeEditor);if(this.instances.length===1){var re=function(){_this.instances[0].resize()};sc.root.on('h-resize',re).on('v-resize',re)}}
i.el=el;this.setSession(session,i);this.changeListener(i);this.bindKeys(i);this.instances.push(i);i.on('focus',function(){_this.focus(i)});return i},createSplitMenu:function(){var _this=this;var _splitOptionsMenu=$('#split-options-menu');this.initMenuHandler($('#split'),_splitOptionsMenu);$('#split-horizontally a').click(function(e){e.stopPropagation();_this.addInstance(_this.activeInstance.getSession(),'bottom');_splitOptionsMenu.hide()});$('#split-vertically a').click(function(e){e.stopPropagation();_this.addInstance(_this.activeInstance.getSession(),'right');_splitOptionsMenu.hide()});$('#merge-all a').click(function(e){e.stopPropagation();var s=_this.activeInstance.getSession();_this.exterminate();_this.addInstance(s);_splitOptionsMenu.hide()})},createModeMenu:function(){var _this=this;var _thisMenu=$('#changemode-menu');var modeColumns=new Array();var modeOptions=new Array();var maxOptionsColumn=15;var firstOption=0;this.initMenuHandler($('#current-mode'),_thisMenu);availableTextModes.sort();$.each(availableTextModes,function(i){modeOptions.push('<li><a>'+availableTextModes[i]+'</a></li>')});var html='<table><tr>';while(!0){html+='<td><ul>';if((modeOptions.length-firstOption)<maxOptionsColumn){max=modeOptions.length}else{max=firstOption+maxOptionsColumn}
var currentcolumn=modeOptions.slice(firstOption,max);for(var option in currentcolumn){html+=currentcolumn[option]}
html+='</ul></td>';firstOption=firstOption+maxOptionsColumn;if(firstOption>=modeOptions.length){break}}
html+='</tr></table>';_thisMenu.html(html);$('#changemode-menu a').click(function(e){e.stopPropagation();var newMode='ace/mode/'+$(e.currentTarget).text();var actSession=_this.activeInstance.getSession();var fn=function(){_this.setModeDisplay(actSession);actSession.removeListener('changeMode',fn)};actSession.on('changeMode',fn);actSession.setMode(newMode);_thisMenu.hide()})},initMenuHandler:function(button,menu){var _this=this;var thisButton=button;var thisMenu=menu;thisMenu.appendTo($('body'));thisButton.click(function(e){var wh=$(window).height();e.stopPropagation();_this.closeMenus(thisMenu);thisMenu.css({bottom:((wh-$(this).offset().top)+8)+'px',left:($(this).offset().left-13)+'px'});thisMenu.slideToggle('fast');var fn=function(){thisMenu.hide();$(window).off('click',fn)};$(window).on('click',fn)})},closeMenus:function(exclude){var menuId=exclude.attr('id');if(menuId!='split-options-menu')$('#split-options-menu').hide();if(menuId!='changemode-menu')$('#changemode-menu').hide()},setModeDisplay:function(session){var currMode=session.getMode().$id;if(currMode){currMode=currMode.substring(currMode.lastIndexOf('/')+1);$('#current-mode').html(currMode)}else{$('#current-mode').html('text')}},exterminate:function(){$('.editor').remove();$('.editor-wrapper').remove();$('#editor-region').append($('<div>').attr('id','editor'));$('#current-file').html('');$('#current-mode').html('');this.instances=[];this.activeInstance=null},removeSession:function(session,replacementSession){for(var k=0;k<this.instances.length;k++){if(this.instances[k].getSession().path===session.path){this.instances[k].setSession(replacementSession)}}
if($('#current-file').text()===session.path){$('#current-file').text(replacementSession.path)}
this.setModeDisplay(replacementSession)},isOpen:function(session){for(var k=0;k<this.instances.length;k++){if(this.instances[k].getSession().path===session.path){return!0}}
return!1},forEach:function(fn){for(var k=0;k<this.instances.length;k++){fn.call(this,this.instances[k])}},getActive:function(){return this.activeInstance},setActive:function(i){if(i){this.activeInstance=i;var path=i.getSession().path;path=(path.length<30)?path:path='...'+path.substr(path.length-30);$('#current-file').text(path);this.setModeDisplay(i.getSession())}},setSession:function(session,i){i=i||this.getActive();if(!this.isOpen(session)){if(!i){i=this.addInstance(session)}else{i.setSession(session)}}else{var proxySession=new EditSession(session.getDocument(),session.getMode());proxySession.setUndoManager(new UndoManager());proxySession.path=session.path;proxySession.listThumb=session.listThumb;proxySession.tabThumb=session.tabThumb;if(!i){i=this.addInstance(proxySession)}else{i.setSession(proxySession)}}
this.applySettings(i);this.setActive(i)},selectMode:function(e){if(typeof(e)!='string'){return'text'}
e=e.toLowerCase();if(e in this.fileExtensionTextMode){return this.fileExtensionTextMode[e]}else{return'text'}},addFileExtensionTextMode:function(extension,mode){if(typeof(extension)!='string'||typeof(mode)!='string'){if(console){console.warn('wrong usage of addFileExtensionTextMode, both parameters need to be string')}
return}
mode=mode.toLowerCase();this.fileExtensionTextMode[extension]=mode},clearFileExtensionTextMode:function(){this.fileExtensionTextMode={}},setMode:function(m,i){i=i||this.getActive();if(!editorModes[m]){var modeFile='components/editor/ace-editor/mode-'+m+'.js';$.loadScript(modeFile,function(){editorModes[m]=!0;var EditorMode=ace.require('ace/mode/'+m).Mode;i.getSession().setMode(new EditorMode())},!0)}else{var EditorMode=ace.require('ace/mode/'+m).Mode;i.getSession().setMode(new EditorMode())}},setTheme:function(t,i){if(i){i.setTheme('ace/theme/'+t)}else{this.settings.theme=t;for(var k=0;k<this.instances.length;k++){this.instances[k].setTheme('ace/theme/'+t)}}
localStorage.setItem('codiad.editor.theme',t)},setContent:function(c,i){i=i||this.getActive();i.getSession().setValue(c)},setFontSize:function(s,i){if(i){i.setFontSize(s)}else{this.settings.fontSize=s;this.forEach(function(i){i.setFontSize(s)})}
localStorage.setItem('codiad.editor.fontSize',s)},setHighlightLine:function(h,i){if(i){i.setHighlightActiveLine(h)}else{this.settings.highlightLine=h;this.forEach(function(i){i.setHighlightActiveLine(h)})}
localStorage.setItem('codiad.editor.highlightLine',h)},setPrintMargin:function(p,i){if(i){i.setShowPrintMargin(p)}else{this.settings.printMargin=p;this.forEach(function(i){i.setShowPrintMargin(p)})}
localStorage.setItem('codiad.editor.printMargin',p)},setPrintMarginColumn:function(p,i){if(i){i.setPrintMarginColumn(p)}else{this.settings.printMarginColumn=p;this.forEach(function(i){i.setPrintMarginColumn(p)})}
localStorage.setItem('codiad.editor.printMarginColumn',p)},setIndentGuides:function(g,i){if(i){i.setDisplayIndentGuides(g)}else{this.settings.indentGuides=g;this.forEach(function(i){i.setDisplayIndentGuides(g)})}
localStorage.setItem('codiad.editor.indentGuides',g)},setCodeFolding:function(f,i){if(i){i.setFoldStyle(f)}else{this.forEach(function(i){i.setFoldStyle(f)})}},setWrapMode:function(w,i){if(i){i.getSession().setUseWrapMode(w)}else{this.forEach(function(i){i.getSession().setUseWrapMode(w)})}
localStorage.setItem('codiad.editor.wrapMode',w)},setPersistentModal:function(t,i){this.settings.persistentModal=t;localStorage.setItem('codiad.editor.persistentModal',t)},setLeftSidebarTrigger:function(t,i){codiad.sidebars.settings.leftSidebarTrigger=t;localStorage.setItem('codiad.sidebars.leftSidebarTrigger',t)},setRightSidebarTrigger:function(t,i){codiad.sidebars.settings.rightSidebarTrigger=t;localStorage.setItem('codiad.sidebars.rightSidebarTrigger',t)},setFileManagerTrigger:function(t,i){this.settings.fileManagerTrigger=t;localStorage.setItem('codiad.editor.fileManagerTrigger',t);codiad.project.loadSide()},setTabSize:function(s,i){if(i){i.getSession().setTabSize(parseInt(s))}else{this.forEach(function(i){i.getSession().setTabSize(parseInt(s))})}
localStorage.setItem('codiad.editor.tabSize',s)},setSoftTabs:function(t,i){if(i){i.getSession().setUseSoftTabs(t)}else{this.forEach(function(i){i.getSession().setUseSoftTabs(t)})}
localStorage.setItem('codiad.editor.softTabs',t)},getContent:function(i){i=i||this.getActive();if(!i)return;var content=i.getSession().getValue();if(!content){content=' '}
return content},resize:function(i){i=i||this.getActive();if(!i)return;i.resize()},changeListener:function(i){var _this=this;i.on('change',function(){codiad.active.markChanged(_this.getActive().getSession().path)})},getSelectedText:function(i){i=i||this.getActive();if(!i)return;return i.getCopyText()},insertText:function(val,i){i=i||this.getActive();if(!i)return;i.insert(val)},promptLine:function(){if(codiad.editor.getActive()!==null){var line=parseInt(prompt('Enter line number:'),10);if(!isNaN(line)){codiad.editor.gotoLine(line);codiad.editor.focus()}}},gotoLine:function(line,i){i=i||this.getActive();if(!i)return;i.gotoLine(line,0,!0)},focus:function(i){i=i||this.getActive();this.setActive(i);if(!i)return;i.focus();codiad.active.focus(i.getSession().path)},cursorTracking:function(i){amplify.subscribe('chrono.kilo',function(){var i=codiad.editor.getActive();if(i){var pos=i.getCursorPosition();$('#cursor-position').html(`${i18n('Ln')}: ${pos.row + 1}&middot;${i18n('Col')}: ${pos.column}`)}})},bindKeys:function(i){var _this=this;i.commands.addCommand({name:'Find',bindKey:{win:'Ctrl-F',mac:'Command-F'},exec:function(e){_this.openSearch('find')}});i.commands.addCommand({name:'Replace',bindKey:{win:'Ctrl-R',mac:'Command-R'},exec:function(e){_this.openSearch('replace')}});i.commands.addCommand({name:'Move Up',bindKey:{win:'Ctrl-up',mac:'Command-up'},exec:function(e){codiad.active.move('up')}});i.commands.addCommand({name:'Move Down',bindKey:{win:'Ctrl-down',mac:'Command-up'},exec:function(e){codiad.active.move('down')}})},openSearch:function(type){if(this.getActive()){codiad.modal.load(400,'components/editor/dialog.php?action=search&type='+type);codiad.modal.hideOverlay()}else{codiad.toast.error('No Open Files')}},search:function(action,i){i=i||this.getActive();if(!i)return;var find=$('#modal_wrapper input[name="find"]').val(),replace=$('#modal_wrapper input[name="replace"]').val();switch(action){case 'find':i.find(find,{backwards:!1,wrap:!0,caseSensitive:!1,wholeWord:!1,regExp:!1});break;case 'replace':i.find(find,{backwards:!1,wrap:!0,caseSensitive:!1,wholeWord:!1,regExp:!1});i.replace(replace);break;case 'replaceAll':i.find(find,{backwards:!1,wrap:!0,caseSensitive:!1,wholeWord:!1,regExp:!1});i.replaceAll(replace);break}}}})(this,jQuery);
// components/filemanager/init.js
// components/filemanager/init.js
(function(global){'use strict';var atheos=global.atheos,amplify=global.amplify,ajax=global.ajax,common=atheos.common,fileIcons=global.FileIcons,o=global.onyx;amplify.subscribe('atheos.loaded',()=>atheos.filemanager.init());atheos.filemanager={clipboard:'',noOpen:['jpg','jpeg','png','gif','bmp','exe','zip','tar','tar.gz'],noBrowser:['jpg','jpeg','png','gif','bmp'],controller:'components/filemanager/controller.php',dialog:'components/filemanager/dialog.php',dialogUpload:'components/filemanager/dialog_upload.php',init:function(){this.nodeListener();common.loadScript('components/filemanager/upload_scripts/jquery.ui.widget.js',!0);common.loadScript('components/filemanager/upload_scripts/jquery.iframe-transport.js',!0);common.loadScript('components/filemanager/upload_scripts/jquery.fileupload.js',!0)},nodeListener:function(){var checkAnchor=function(node){node=o(node);var tagName=node.el.tagName;if(tagName==='UL'){return!1}else if(tagName!=='A'){if(tagName==='LI'){node=node.find('a')[0]}else{node=o(node.parent())}}
return node};var nodeFunctions=(function(node){if(node){node=o(node);if(node.attr('data-type')==='directory'||node.attr('data-type')==='root'){this.openDir(node.attr('data-path'))}else{this.openFile(node.attr('data-path'))}}}).bind(this);o('#file-manager').on('click',function(e){if(!atheos.editor.settings.fileManagerTrigger){nodeFunctions(checkAnchor(e.target))}});o('#file-manager').on('dblclick',function(e){if(atheos.editor.settings.fileManagerTrigger){nodeFunctions(checkAnchor(e.target))}})},indexFiles:[],openDir:function(path,rescan){var fileManager=this,slideDuration=200;rescan=rescan||!1;var node=o('#file-manager a[data-path="'+path+'"]');let icon=node.find('.expand')[0];if(node.hasClass('open')&&!rescan){node.removeClass('open');var list=node.siblings('ul')[0];if(list){atheos.animation.slide('close',list.el,slideDuration);if(icon){icon.replaceClass('fa-minus','fa-plus')}
setTimeout(function(){list.remove()},slideDuration)}}else{if(icon){icon.addClass('loading')}
ajax({url:this.controller+'?action=index&path='+encodeURIComponent(path),success:function(response){response=JSON.parse(response);if(response.status!=='error'){fileManager.indexFiles=response.data.index;var files=fileManager.indexFiles;if(files.length>0){if(icon){icon.replaceClass('fa-plus','fa-minus')}
var display=' style="display:none;"';if(rescan){display=''}
var appendage='<ul'+display+'>';files.forEach(function(file){appendage+=fileManager.createDirectoryItem(file.path,file.type,file.size)});appendage+='</ul>';if(rescan&&node.siblings('ul')[0]){node.siblings('ul')[0].remove()}
node.after(appendage);var list=node.siblings('ul')[0];if(!rescan&&list){atheos.animation.slide('open',list.el,slideDuration)}}
amplify.publish('filemanager.onIndex',{path:path,files:fileManager.indexFiles})}
node.addClass('open');if(icon){icon.removeClass('loading');icon.replaceClass('fa-plus','fa-minus')}
if(rescan&&fileManager.rescanChildren.length>fileManager.rescanCounter){fileManager.rescan(fileManager.rescanChildren[fileManager.rescanCounter++])}else{fileManager.rescanChildren=[];fileManager.rescanCounter=0}}})}},createDirectoryItem:function(path,type,size){var name=common.getNodeName(path);var fileClass=type==='directory'?'fa fa-folder medium-blue':fileIcons.getClassWithColor(name);var nodeClass='none';if(type==='directory'&&(size>0)){nodeClass='fa fa-plus'}
fileClass=fileClass||'fa fa-file medium-green';return `<li>
						<a data-type="${type}" data-path="${path}">
							<i class="expand ${nodeClass}"></i>
							<i class="${fileClass}"></i>
							<span>${name}</span>
						</a>
					</li>`},rescanChildren:[],rescanCounter:0,rescan:function(path){if(this.rescanCounter===0){var list=o('#file-manager a[data-path="'+path+'"]').siblings('ul')[0];var openNodes=list.find('a.open');for(var i=0;i<openNodes.length;i++){this.rescanChildren.push(openNodes[i].attr('data-path'))}}
this.openDir(path,!0)},openFile:function(path,focus,line){focus=focus||!0;var ext=common.getNodeExtension(path).toLowerCase();if(this.noOpen.indexOf(ext)<0){ajax({url:this.controller+'?action=open&path='+encodeURIComponent(path),success:function(response){response=JSON.parse(response);if(response.status!=='error'){atheos.active.open(path,response.data.content,response.data.mtime,!1,focus);if(line){atheos.active.gotoLine(line)}}}})}else{if(!atheos.project.isAbsPath(path)){if(this.noBrowser.indexOf(ext)<0){this.download(path)}else{this.openInModal(path)}}else{atheos.toast.error('Unable to open file in Browser')}}},openInBrowser:function(path){ajax({url:this.controller+'?action=open_in_browser&path='+encodeURIComponent(path),success:function(response){response=JSON.parse(response);if(response!='error'){window.open(response.url,'_newtab')}},async:!1})},openInModal:function(path){atheos.modal.load(250,this.dialog,{action:'preview',path:path})},saveModifications:function(path,data,callbacks){callbacks=callbacks||{};var fileManager=this;var notifySaveErr=function(){atheos.toast.error('File could not be saved');if(typeof callbacks.error==='function'){var context=callbacks.context||fileManager;callbacks.error.apply(context,[data])}};ajax({type:'post',url:this.controller+'?action=modify&path='+encodeURIComponent(path),data:data,success:function(response){response=JSON.parse(response);var context;if(response.status==='success'){atheos.toast.success('File saved');if(typeof callbacks.success==='function'){context=callbacks.context||fileManager;callbacks.success.call(context,response.data.mtime)}}else{if(response.message==='Client is out of sync'){atheos.alert.show({banner:'File contents changed on server!',message:'Would you like to retreieve an updated copy of the file?\n'+'Pressing no will cause your changes to override the\n'+'server\'s copy upon next save.',positive:{message:'Yes',fnc:function(){atheos.active.close(path);atheos.active.removeDraft(path);fileManager.openFile(path)}},negative:{message:'No',fnc:function(){var session=atheos.editor.getActive().getSession();session.serverMTime=null;session.untainted=null}}})}else{atheos.toast.error('File could not be saved')}
if(typeof callbacks.error==='function'){context=callbacks.context||fileManager;callbacks.error.apply(context,[response.data])}}}})},saveFile:function(path,content,callbacks){this.saveModifications(path,{content:content},callbacks)},savePatch:function(path,patch,mtime,callbacks){if(patch.length>0){this.saveModifications(path,{patch:patch,mtime:mtime},callbacks)}else if(typeof callbacks.success==='function'){var context=callbacks.context||this;callbacks.success.call(context,mtime)}},copy:function(path){this.clipboard=path;atheos.toast.success('Copied to Clipboard')},paste:function(path){var fileManager=this;var processPaste=function(path,duplicate){var nodeName=common.getNodeName(fileManager.clipboard);var type=common.getNodeType(fileManager.clipboard);if(duplicate){nodeName='copy_of_'+nodeName}
ajax({url:`${fileManager.controller}?action=duplicate&path=${encodeURIComponent(fileManager.clipboard)}'&destination='${encodeURIComponent(path + '/' + nodeName)}`,success:function(response){console.log(response);response=JSON.parse(response);if(response.status!=='error'){fileManager.addToFileManager(path+'/'+nodeName,type,path);amplify.publish('filemanager.onPaste',{path:path,nodeName:nodeName,duplicate:duplicate})}}})};if(this.clipboard===''){atheos.toast.error('Nothing in Your Clipboard')}else if(path===this.clipboard){atheos.toast.error('Cannot Paste Directory Into Itself')}else{var nodeName=common.getNodeName(fileManager.clipboard);if(o('#file-manager a[data-path="'+path+'/'+nodeName+'"]')){atheos.alert.show({banner:'Path already exists!',message:'Would you like to overwrite or duplicate the file?',data:`/${path}/${nodeName}`,actions:[{message:'Overwrite',fnc:function(){console.log('Overwrite');processPaste(path,!1)}},{message:'Duplicate',fnc:function(){console.log('Duplicate');processPaste(path,!0)}}]})}else{processPaste(path,!1)}}},duplicate:function(path,name){var fileManager=this;var nodeName=common.getNodeName(path);var type=common.getNodeType(path);atheos.modal.load(250,this.dialog,{action:'duplicate',path:path,nodeName:nodeName,type:type});atheos.modal.ready.then(function(){o('#modal_content form').once('submit',function(e){e.preventDefault();var newName=o('#modal_content form input[name="object_name"]').value();var parent=path.split('/').slice(0,-1).join('/');var newPath=parent+'/'+newName;ajax({url:`${fileManager.controller}?action=duplicate&path=${encodeURIComponent(path)}'&destination='${encodeURIComponent(newPath)}`,success:function(response){response=JSON.parse(response);atheos.toast[response.status](response.message);if(response.status!=='error'){fileManager.addToFileManager(newPath,type,parent);atheos.modal.unload();amplify.publish('filemanager.onPaste',{path:path,nodeName:nodeName})}}});atheos.modal.unload()})})},create:function(path,type){var fileManager=this;atheos.modal.load(250,this.dialog,{action:'create',type:type});atheos.modal.ready.then(function(){o('#modal_content form').once('submit',function(e){e.preventDefault();var nodeName=o('#modal_content form input[name="nodeName"]').value();var newPath=path+'/'+nodeName;ajax({url:`${atheos.filemanager.controller}?action=create&path=${encodeURIComponent(newPath)}&type=${type}`,success:function(response){response=JSON.parse(response);if(response.status!=='error'){atheos.toast.success('File Created');atheos.modal.unload();atheos.filemanager.addToFileManager(newPath,type,path);if(type==='file'){atheos.filemanager.openFile(newPath,!0)}
amplify.publish('filemanager.onCreate',{createPath:newPath,path:path,nodeName:nodeName,type:type})}}})})})},addToFileManager:function(path,type,parent){var parentNode=o('#file-manager a[data-path="'+parent+'"]');if(!o('#file-manager a[data-path="'+path+'"]')){if(parentNode.hasClass('open')&&parentNode.attr('data-type').match(/^(directory|root)$/)){var node=this.createDirectoryItem(path,type,0);var list=parentNode.siblings('ul')[0];if(list){list.append(node);this.sortPath(list.el)}else{list=o('<ul>');list.append(node);parentNode.append(list.el)}}else{if(parentNode.find('.expand')[0]){parentNode.find('.expand')[0].replaceClass('none','fa fa-plus')}}}},sortPath:function(list){var nodesToSort=list.children;nodesToSort=Array.prototype.map.call(nodesToSort,function(node){return{node:node,span:node.querySelector('span').textContent,type:node.querySelector('a').getAttribute('data-type')}});nodesToSort.sort(function(a,b){return a.span.localeCompare(b.span)});nodesToSort.sort(function(a,b){return a.type.localeCompare(b.type)});nodesToSort.forEach(function(item){list.appendChild(item.node)})},rename:function(path){var nodeName=common.getNodeName(path);var type=common.getNodeType(path);var fileManager=this;atheos.modal.load(250,this.dialog,{action:'rename',path:path,nodeName:nodeName,type:type});atheos.modal.ready.then(function(){o('#modal_content form').on('submit',function(e){e.preventDefault();var newName=o('#modal_content form input[name="object_name"]').value();var arr=path.split('/');var temp=[];for(var i=0;i<arr.length-1;i++){temp.push(arr[i])}
var newPath=temp.join('/')+'/'+newName;ajax({url:fileManager.controller,data:{action:'modify',path:path,newName:newName},success:function(response){response=JSON.parse(response);if(response.status!=='error'){atheos.toast.success('File Renamed');var node=o('#file-manager a[data-path="'+path+'"]'),icon=node.find('i:nth-child(2)')[0],span=node.find('span')[0];node.attr('data-path',newPath);span.text(newName);if(type==='file'){icon.removeClass();icon.addClass(fileIcons.getClassWithColor(newName))}else{fileManager.repathChildren(path,newPath)}
atheos.active.rename(path,newPath)}}});atheos.modal.unload()})})},repathChildren:function(oldPath,newPath){var node=o('#file-manager a[data-path="'+newPath+'"]'),ul=node.el.nextElementSibling;if(ul){var children=ul.querySelectorAll('a');for(var i=0;i<children.length;i++){var path=children[i].getAttribute('data-path');path=path.replace(oldPath,newPath);children[i].setAttribute('data-path',path)}}},delete:function(path){var filemanager=this;atheos.modal.load(400,this.dialog,{action:'delete',path:path});atheos.modal.ready.then(function(){o('#modal_content form').once('submit',function(e){e.preventDefault();ajax({url:filemanager.controller+'?action=delete&path='+encodeURIComponent(path),success:function(response){response=JSON.parse(response);if(response!=='error'){var node=o('#file-manager a[data-path="'+path+'"]');node.parent('li').remove();var active=document.querySelectorAll('#active-files a');for(var i=0;i<active.length;i++){var curPath=o(active[i]).attr('data-path');if(curPath.indexOf(path)===0){atheos.active.remove(curPath)}}}
atheos.modal.unload()}})})})},upload:function(path){atheos.modal.load(500,this.dialogUpload,{path:path})},download:function(path){var type=this.getType(path);o('#download').attr('src','components/filemanager/download.php?path='+encodeURIComponent(path)+'&type='+type)},slide:function(direction,target,duration=500){target.style.overflow='hidden';target.style.transitionProperty='height, margin, padding';target.style.transitionDuration=duration+'ms';var zeroStyles=function(){target.style.height=0;target.style.paddingTop=0;target.style.paddingBottom=0;target.style.marginTop=0;target.style.marginBottom=0};if(window.getComputedStyle(target).display==='none'||direction==='open'){target.style.removeProperty('display');var display=window.getComputedStyle(target).display;display=display==='none'?'block':display;target.style.display=display;var height=target.offsetHeight;zeroStyles();target.offsetHeight;target.style.boxSizing='border-box';target.style.height=height+'px';target.style.removeProperty('padding-top');target.style.removeProperty('padding-bottom');target.style.removeProperty('margin-top');target.style.removeProperty('margin-bottom');window.setTimeout(()=>{target.setAttribute('style','')},duration)}else{target.style.boxSizing='border-box';target.style.height=target.offsetHeight+'px';target.offsetHeight;zeroStyles();window.setTimeout(()=>{target.setAttribute('style','');target.style.display='none'},duration)}}}})(this);
// components/finder/init.js
// components/finder/init.js
(function(global,$){var atheos=global.atheos,amplify=global.amplify,ajax=global.ajax,fileIcons=global.FileIcons,o=global.onyx;amplify.subscribe('atheos.loaded',function(settings){atheos.finder.init()});atheos.finder={finderExpanded:!1,menu:'',rootName:'',rootPath:'',htmlCache:'',options:{},init:function(){var finder=this;o('#tree-search').on('click',function(){if(!finder.finderExpanded){finder.expandFinder()}else{finder.contractFinder()}});o('#finder-label').on('click',function(){finder.expandFinder()});var menu=o('#finder-options-menu');var $finderOptionsMenu=$('#finder-options-menu');finder.menu=menu;$('#finder-options').click(function(){$finderOptionsMenu.toggle()});$finderOptionsMenu.bind('click','a',function(e){var $target=$(e.target);var strategy=$target.attr('data-option');var action=$target.attr('data-action');if(strategy){finder.options.strategy=strategy;$finderOptionsMenu.find('li.chosen').removeClass('chosen');$target.parent('li').addClass('chosen')}else if(action){atheos.filemanager[action](atheos.project.getCurrent());finder.contractFinder()}
$finderOptionsMenu.hide()})},createDirectoryItem:function(name,obj){console.log(name);console.log(obj);var fileClass=obj.type==='directory'?'fa fa-folder medium-blue':fileIcons.getClassWithColor(name);var nodeClass='none';if(obj.type==='directory'&&(obj.children)){nodeClass='fa fa-plus'}
fileClass=fileClass||'fa fa-file medium-green';var node='<li>';node+=`<a data-type="${obj.type}" data-path="${obj.path}">
						<i class="expand ${nodeClass}"></i>
						<i class="${fileClass}"></i>
						<span>${name}</span>
					</a>`;if(obj.children){node+='<ul>';for(var key in obj.children){node+=this.createDirectoryItem(key,obj.children[key])}
node+='</ul>'}
node+='</li>';return node},createDirectory:function(tree){var str="<ul>";for(var key in tree){str+=this.createDirectoryItem(key,tree[key])}
str+="</ul>";return str},createHierarchy:function(data){data=data.index;var tree={},fpathArr,i,j,fragment,curLevel,type;for(i=0;i<data.length;i++){curLevel=tree;if(atheos.project.isAbsPath(data[i].path)){fpathArr=data[i].path.replace(this.rootPath,this.rootName).split('/')}else{fpathArr=data[i].path.split('/')}
for(j=0;j<fpathArr.length;j++){fragment=fpathArr[j];if(fragment===""){continue}
if(!curLevel[fragment]){type=j<fpathArr.length-1?'directory':data[i].type;curLevel[fragment]={type:type,children:{}};if(type==='file'){curLevel[fragment].path=data[i].path}else{if(atheos.project.isAbsPath(data[i].path)){curLevel[fragment].path=fpathArr.slice(0,j+1).join('/').replace(this.rootName,this.rootPath)}else{curLevel[fragment].path=fpathArr.slice(0,j+1).join('/')}}}
curLevel=curLevel[fragment].children}}
return tree},_filterTree:function(data){var tree=this.createHierarchy(data);var domTree=this.createDirectory(tree);$('#file-manager').html(domTree);$('#file-manager>ul>li:first-child>span').remove();$('#file-manager>ul>li:first-child>a').attr({id:'project-root','data-type':'root','data-path':this.rootPath})},_clearFilters:function(){if(this.htmlCache)
$('#file-manager').html(this.htmlCache);this.htmlCache=null;$('#finder').attr('value','')},_emptyTree:function(){$('#file-manager').html("No files found .")},checkFinder:function(){var fentry=$('#finder').attr('value');var _this=this;fentry=fentry.replace(/^\s+|\s+$/g,'');if(!fentry||fentry==this._lastEntry)return;else{if(this._xhr)this._xhr.abort();this._lastEntry=fentry;this._xhr=$.ajax({url:'components/filemanager/controller.php',type:'GET',dataType:'json',data:{query:fentry,action:'find',path:this.rootPath,options:this.options},success:function(data){if(data.status==='success'){_this._filterTree(data.data)}else{_this._emptyTree()}}})}},expandFinder:function(){this.finderExpanded=!0;this.htmlCache=$('#file-manager').html();this.rootPath=$('#project-root').attr('data-path');this.rootName=$('#project-root').html();$("#finder-wrapper").show();$("#sb-left-title h2").hide();this._lastEntry=null;amplify.subscribe('chrono.kilo',this.checkFinder);$("#finder").focus();$("#finder-quick").hide();$("#sb-left-title").addClass('active');$("#tree-search").removeClass('icon-search').addClass('icon-cancel-squared active')},contractFinder:function(){this.finderExpanded=!1;$("#finder-wrapper").hide('fast');$("#sb-left-title h2").show('fast');this.menu.hide();this._clearFilters();amplify.unsubscribe('chrono.kilo',this.checkFinder);$("#finder-quick").show();$("#sb-left-title").removeClass('active');$("#tree-search").removeClass('icon-cancel-squared active').addClass('icon-search')}}})(this,jQuery);
// components/market/init.js
// components/market/init.js
(function(global){'use strict';var atheos=global.atheos,amplify=global.amplify,ajax=global.ajax,o=global.onyx;amplify.subscribe('atheos.loaded',function(){atheos.market.init()});atheos.market={controller:'components/market/controller.php',dialog:'components/market/dialog.php',init:function(){},list:function(type,note){atheos.modal.load(800,this.dialog+'?action=list&type='+type+'&note='+note)},search:function(e,query,note){var key=e.charCode||e.keyCode||e.which;if(query!==''&&key==13){atheos.modal.load(800,this.dialog+'?action=list&note='+note+'&type=undefined&query='+query)}},openInBrowser:function(path){window.open(path,'_newtab')},install:function(page,type,name,repo){var market=this;if(repo!==''){o('#modal_content').html('<div id="modal-loading"></div><div align="center">Installing '+name+'...</div><br>');ajax({url:this.controller+'?action=install&type='+type+'&name='+name+'&repo='+repo,success:function(data){var response=atheos.jsend.parse(data);if(response=='error'){atheos.toast.error(response.message)}
market.list(page,!0)}})}else{atheos.toast.error('No Repository URL')}},remove:function(page,type,name){var market=this;o('#modal_content').html('<div id="modal-loading"></div><div align="center">Deleting '+name+'...</div><br>');ajax({url:this.controller+'?action=remove&type='+type+'&name='+name,success:function(data){var response=atheos.jsend.parse(data);if(response=='error'){atheos.toast.error(response.message)}
market.list(page,!0)}})},update:function(page,type,name){var market=this;o('#modal_content').html('<div id="modal-loading"></div><div align="center">Updating '+name+'...</div><br>');ajax({url:this.controller+'?action=update&type='+type+'&name='+name,success:function(data){var response=atheos.jsend.parse(data);if(response=='error'){atheos.toast.error(response.message)}
market.list(page,!1)}})},}})(this);
// components/project/init.js
// components/project/init.js
(function(global,$){var atheos=global.atheos,amplify=global.amplify,i18n=global.i18n,o=global.onyx;amplify.subscribe('atheos.loaded',function(settings){atheos.project.init()});atheos.project={controller:'components/project/controller.php',dialog:'components/project/dialog.php',sideExpanded:!0,current:{name:'',path:''},init:function(){this.loadCurrent();this.loadSide();var project=this;o('#projects-create').on('click',function(){atheos.project.create('true')});o('#projects-manage').on('click',function(){atheos.project.list()});o('#projects-collapse').on('click',function(){if(!project.sideExpanded){project.expand()}else{project.collapse()}});amplify.subscribe('chrono.mega',function(){project.getCurrent()})},loadCurrent:function(){var project=this;ajax({url:this.controller,type:'post',data:{'action':'load'},success:function(response){response=JSON.parse(response);if(response.status!='error'){project.current={name:response.name,path:response.path};o('#file-manager').empty();o('#file-manager').html(`<ul><li>
									<a id="project-root" data-type="root" data-path="${response.path}">
									<i class="root fa fa-folder medium-blue"></i>
									<span>${response.name}</span>
									</a>
								</li></ul>`);atheos.filemanager.openDir(response.path);atheos.user.saveActiveProject(response.path);atheos.toast.success('Project Loaded')}}})},open:function(path){var project=this;atheos.finder.contractFinder();ajax({url:this.controller+'?action=open&path='+encodeURIComponent(path),success:function(response){response=JSON.parse(response);if(response.status!='error'){project.loadCurrent();if(atheos.modal.settings.isModalVisible){atheos.modal.unload()}
atheos.user.saveActiveProject(path);localStorage.removeItem("lastSearched");amplify.publish('project.onOpen',path)}}})},list:function(){$('#modal_content form').die('submit');atheos.modal.load(500,this.dialog+'?action=list')},loadSide:function(){$('.sb-projects-content').load(this.dialog+'?action=sidelist&trigger='+localStorage.getItem('atheos.editor.fileManagerTrigger'));this.sideExpanded=!0},expand:function(){this.sideExpanded=!0;$('#side-projects').css('height',276+'px');$('.project-list-title').css('right',0);$('.sb-left-content').css('bottom',276+'px');$('#projects-collapse').removeClass('icon-up-dir').addClass('icon-down-dir')},collapse:function(){this.sideExpanded=!1;$('#side-projects').css('height',33+'px');$('.project-list-title').css('right',0);$('.sb-left-content').css('bottom',33+'px');$('#projects-collapse').removeClass('icon-down-dir').addClass('icon-up-dir')},create:function(close){var _this=this;atheos.modal.load(500,this.dialog+'?action=create&close='+close);$('#modal_content form').live('submit',function(e){e.preventDefault();var projectName=$('#modal_content form input[name="project_name"]').val(),projectPath=$('#modal_content form input[name="project_path"]').val(),gitRepo=$('#modal_content form input[name="git_repo"]').val(),gitBranch=$('#modal_content form input[name="git_branch"]').val();var create=function(){$.get(_this.controller+'?action=create&project_name='+encodeURIComponent(projectName)+'&project_path='+encodeURIComponent(projectPath)+'&git_repo='+gitRepo+'&git_branch='+gitBranch,function(data){var createResponse=atheos.jsend.parse(data);if(createResponse!=='error'){_this.open(createResponse.path);atheos.modal.unload();_this.loadSide();amplify.publish('project.onCreate',{"name":projectName,"path":projectPath,"git_repo":gitRepo,"git_branch":gitBranch})}})};if(projectPath.indexOf('/')===0){atheos.alert.show({banner:'Do you really want to create a project with an absolute path?',data:projectPath,positive:{message:'Yes',fnc:function(){create()}},negative:{message:'No',fnc:function(){}}})}else{create()}})},rename:function(name,path){var _this=this;atheos.modal.load(500,this.dialog+'?action=rename&path='+encodeURIComponent(path)+'&name='+name);$('#modal_content form').live('submit',function(e){e.preventDefault();var projectPath=$('#modal_content form input[name="project_path"]').val();var projectName=$('#modal_content form input[name="project_name"]').val();$.get(_this.controller+'?action=rename&project_path='+encodeURIComponent(projectPath)+'&project_name='+encodeURIComponent(projectName),function(data){var renameResponse=atheos.jsend.parse(data);if(renameResponse!='error'){atheos.toast.success('Project renamed');_this.loadSide();$('#file-manager a[data-type="root"]').html(projectName);atheos.modal.unload();amplify.publish('project.onRename',{"path":projectPath,"name":projectName})}})})},delete:function(name,path){var _this=this;atheos.modal.load(500,this.dialog+'?action=delete&name='+encodeURIComponent(name)+'&path='+encodeURIComponent(path));$('#modal_content form').live('submit',function(e){e.preventDefault();var projectPath=$('#modal_content form input[name="project_path"]').val();var deletefiles=$('input:checkbox[name="delete"]:checked').val();var followlinks=$('input:checkbox[name="follow"]:checked').val();var action='?action=delete';if(typeof deletefiles!=='undefined'){if(typeof followlinks!=='undefined'){action+='&follow=true&path='+encodeURIComponent(projectPath)}else{action+='&path='+encodeURIComponent(projectPath)}}
$.get(atheos.filemanager.controller+action,function(d){$.get(_this.controller+'?action=delete&project_path='+encodeURIComponent(projectPath),function(data){var deleteResponse=atheos.jsend.parse(data);if(deleteResponse!='error'){atheos.toast.success('Project Deleted');_this.list();_this.loadSide();$('#active-files a').each(function(){var curPath=$(this).attr('data-path');if(curPath.indexOf(projectPath)===0){atheos.active.remove(curPath)}});amplify.publish('project.onDelete',{"path":projectPath,"name":name})}})})})},isAbsPath:function(path){return(path.indexOf("/")==0)?!0:!1},getCurrent:function(){var project=this;ajax({url:this.controller,type:'post',data:{action:"current"},success:function(response){response=JSON.parse(response);if(response.status==='success'){project.current.path=response.path}}});return project.current.path}}})(this,jQuery);
// components/scout/init.js
// components/scout/init.js
(function(global){'use strict';var atheos=global.atheos,amplify=global.amplify,ajax=global.ajax,o=global.onyx;amplify.subscribe('atheos.loaded',()=>atheos.scout.init());atheos.scout={controller:'components/scout/controller.php',dialog:'components/scout/dialog.php',init:function(){var scout=this;o('#finder-quick').on('click',function(e){scout.search(atheos.project.getCurrent())})},search:function(path){var search=this;atheos.modal.load(500,this.dialog,{action:'search',path:path});atheos.modal.ready.then(function(){var table=o('#search_results');var lastSearched=JSON.parse(localStorage.getItem('lastSearched'));if(lastSearched){o('#modal_content form input[name="search_string"]').value(lastSearched.searchText);o('#modal_content form input[name="search_file_type"]').value(lastSearched.fileExtension);o('#modal_content form select[name="search_type"]').value(lastSearched.searchType);if(lastSearched.searchResults!==''){table.html(lastSearched.searchResults);atheos.animation.slide('open',table.el);atheos.modal.resize()}}
var listener=function(e){e.preventDefault();o('#search_processing').show();var searchString=o('#modal_content form input[name="search_string"]').value();var fileExtensions=o('#modal_content form input[name="search_file_type"]').value();var searchFileType=fileExtensions.trim();if(searchFileType!==''){searchFileType='\\('+searchFileType.replace(/\s+/g,'\\|')+'\\)'}
var searchType=o('#modal_content form select[name="search_type"]').value();ajax({type:'post',url:search.controller+'?action=search&path='+encodeURIComponent(path)+'&type='+searchType,data:{search_string:searchString,search_file_type:searchFileType,searchString:searchString,searchFileType:searchFileType},success:function(response){response=JSON.parse(response);table.empty();var results='';if(response.status!=='error'){var index=response.data;for(var key in index){if(!index.hasOwnProperty(key)){continue}
var file=index[key];if(key.substr(-1)==='/'){key=key.substr(0,key.substr.length-1)}
var node=o('<div>'),content='<span><strong>File: </strong>'+key+'</span>';node.addClass('file');file.forEach(function(result){result.string=String(result.string).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');content+=`<a class="result" onclick="atheos.filemanager.openFile('${result.path}',true,${result.line});atheos.modal.unload();"><span>Line ${result.line}: </span>${result.string}
												</a>`});node.html(content);table.append(node)}
results=table.html();atheos.animation.slide('open',table.el)}else{atheos.animation.slide('close',table.el)}
search.saveSearchResults(searchString,searchType,fileExtensions,results);o('#search_processing').hide();atheos.modal.resize()}})};o('#modal_content form').on('submit',listener)})},saveSearchResults:function(searchText,searchType,fileExtensions,searchResults){var lastSearched={searchText:searchText,searchType:searchType,fileExtension:fileExtensions,searchResults:searchResults};localStorage.setItem('lastSearched',JSON.stringify(lastSearched))}}})(this);
// components/settings/init.js
// components/settings/init.js
(function(global,$){var atheos=global.atheos,amplify=global.amplify,oX=global.onyx,storage=atheos.storage;amplify.subscribe('atheos.loaded',function(settings){atheos.settings.init()});atheos.settings={controller:'components/settings/controller.php',init:function(){$('body').append('<iframe src="components/settings/dialog.php?action=iframe"></iframe>');oX('#settings_open').on('click',function(){atheos.settings.show()});this.load()},publish:function(setting,value){var boolean=(value==='true');var int=(!isNaN(parseFloat(value))&&isFinite(value))?parseInt(value,10):0;if(value===null){atheos.toast.alert("You Must Choose A Value");return}else{switch(setting){case 'editor.theme':atheos.editor.setTheme(value);break;case 'editor.fontSize':atheos.editor.setFontSize(value);break;case 'editor.highlightLine':atheos.editor.setHighlightLine(value);break;case 'editor.indentGuides':atheos.editor.setIndentGuides(boolean);break;case 'editor.printMargin':atheos.editor.setPrintMargin(boolean);break;case 'editor.printMarginColumn':atheos.editor.setPrintMarginColumn(int);break;case 'editor.wrapMode':atheos.editor.setWrapMode(boolean);break;case 'editor.rightSidebarTrigger':atheos.editor.setRightSidebarTrigger(boolean);break;case 'editor.fileManagerTrigger':atheos.editor.setFileManagerTrigger(boolean);break;case 'editor.persistentModal':atheos.editor.setPersistentModal(boolean);break;case 'editor.softTabs':atheos.editor.setSoftTabs(boolean);break;case 'editor.tabSize':atheos.editor.setTabSize(value);break}}},save:function(target){if(target){var setting=target.attr('data-setting');var value=target.value();this.publish(setting,value)}else{var settings={};var systemRegex=/^atheos/;var pluginRegex=/^atheos.plugin/;var syncSystem=storage('syncSystem');var syncPlugin=storage('syncPlugin');var panel=oX('#settings #panel_view');if(syncSystem||syncPlugin){for(var i=0;i<localStorage.length;i++){var key=localStorage.key(i);if(systemRegex.test(key)&&!pluginRegex.test(key)&&syncSystem){settings[key]=localStorage.getItem(key)}
if(pluginRegex.test(key)&&syncPlugin){settings[key]=localStorage.getItem(key)}}}
settings.syncSystem=syncSystem;settings.syncPlugin=syncPlugin;console.log(settings);$.post(this.controller+'?action=save',{settings:JSON.stringify(settings)},function(data){var parsed=atheos.jsend.parse(data)});amplify.publish('settings.save')}},load:function(){$.get(this.controller+'?action=load',function(data){var parsed=atheos.jsend.parse(data);if(parsed!=='error'){$.each(parsed,function(i,item){localStorage.setItem(i,item)});amplify.publish('settings.loaded',parsed)}})},show:function(dataFile){var settings=this;atheos.modal.load(800,'components/settings/dialog.php?action=settings');atheos.modal.ready.then(function(){oX('#modal_wrapper').on('change',function(e){var target=oX(e.target);var tagName=target.el.tagName;var type=target.el.type;if(tagName==='SELECT'||(tagName==='INPUT'&&type==='checkbox')){settings.save(target)}});oX('#panel_menu').on('click',function(e){var target=oX(e.target);var tagName=target.el.tagName;if(tagName==='A'){settings.showTab(target.attr('data-file'))}});$('.settings-view .config-menu li').click(function(){});if(typeof(dataFile)=='string'){settings.showTab(dataFile)}else{settings.loadTabValues('components/settings/settings.editor.php')}})},showTab:function(dataFile){var settings=this;if(typeof(dataFile)==='string'){settings.save(!1);oX('#panel_menu .active').removeClass('active');oX('#panel_menu a[data-file="'+dataFile+'"]').addClass('active');oX('#panel_view').empty();$('#panel_view').load(dataFile,function(){settings.loadTabValues(dataFile)})}},loadTabValues:function(dataFile){var key,value;$('.settings-view .panel[data-file="'+dataFile+'"] .setting').each(function(i,item){key=$(item).attr('data-setting');value=localStorage.getItem(key);if(value!==null){$(item).val(value)}})}}})(this,jQuery);
// components/sidebars/init.js
// components/sidebars/init.js
(function(global){'use strict';var sidebars=null;var atheos=global.atheos,amplify=global.amplify,oX=global.onyx;amplify.subscribe('atheos.loaded',()=>atheos.sidebars.init());atheos.sidebars={settings:{leftLockedVisible:!0,rightLockedVisible:!1,leftOpenOnClick:!1,rightOpenOnClick:!1,isLeftSidebarOpen:!0,isRightSidebarOpen:!1,leftSidebarClickOpen:!1,rightSidebarClickOpen:!1,hoverDuration:300},init:function(){sidebars=this;var sbLeftWidth=atheos.storage('sidebars.sb-left-width'),sbRightWidth=atheos.storage('sidebars.sb-right-width');if(sbLeftWidth!==null){oX('#sb-left').css({'width':sbLeftWidth+'px',})}
if(sbRightWidth!==null){oX('#sb-right').css({'width':sbRightWidth+'px','right':-(sbRightWidth-15)+'px'})}
this.sbLeft.init();this.sbRight.init();sidebars.leftOpenOnClick=atheos.storage('sidebars.leftOpenOnClick');sidebars.rightOpenOnClick=atheos.storage('sidebars.rightOpenOnClick');if(atheos.storage('sidebars.leftLockedVisible')===!1){oX('#sb-left-lock').trigger('click');sidebars.sbLeft.close()}
if(atheos.storage('sidebars.rightLockedVisible')){oX('#sb-right-lock').trigger('click');sidebars.sbRight.open()}
amplify.subscribe('settings.loaded',function(settings){var handleWidth=oX('#sb-left-handle').clientWidth();var marginL=handleWidth,marginR=handleWidth;if(atheos.sidebars.settings.leftLockedVisible){marginL=oX('#sb-left').clientWidth()}
if(atheos.sidebars.settings.rightLockedVisible){marginR=oX('#sb-right').clientWidth()}
oX('#editor-region').css({'margin-left':marginL+'px','margin-right':marginR+'px',})})},sbLeft:{sidebar:null,handle:null,icon:null,timeoutOpen:null,timeoutClose:null,hoverDuration:300,init:function(){this.sidebar=oX('#sb-left');this.handle=oX('#sb-left-handle');this.icon=oX('#sb-left-lock');this.hoverDuration=atheos.storage('sidebars.hoverDuration')||300;this.icon.on('click',function(e){sidebars.sbLeft.lock()});this.handle.on('mousedown',function(e){sidebars.resize(oX('#sb-left').el,'left')});this.handle.on('click',function(){if(sidebars.settings.leftOpenOnClick){sidebars.sbLeft.open()}});this.sidebar.on('mouseout',function(){sidebars.sbLeft.close()});this.sidebar.on('mouseover',function(){if(!sidebars.settings.leftOpenOnClick){sidebars.sbLeft.open()}})},open:function(){var sidebarWidth=this.sidebar.clientWidth();if(this.timeoutClose){clearTimeout(this.timeoutClose)}
this.timeoutOpen=setTimeout((function(){this.sidebar.css('left','0px');oX('#editor-region').css('margin-left',sidebarWidth+'px');setTimeout(function(){atheos.sidebars.settings.isLeftSidebarOpen=!0;atheos.sidebars.sbLeft.sidebar.trigger('h-resize-init');atheos.active.updateTabDropdownVisibility()},300)}).bind(this),this.hoverDuration)},close:function(){var sidebarWidth=this.sidebar.clientWidth(),sidebarHandleWidth=this.handle.clientWidth();if(this.timeoutOpen){clearTimeout(this.timeoutOpen)}
sidebarWidth=oX('#sb-left').clientWidth();this.timeoutClose=setTimeout((function(){if(!atheos.sidebars.settings.leftLockedVisible){this.sidebar.css('left',(-sidebarWidth+sidebarHandleWidth)+'px');oX('#editor-region').css('margin-left','15px');setTimeout(function(){atheos.sidebars.settings.isLeftSidebarOpen=!1;atheos.active.updateTabDropdownVisibility()},300)}}).bind(this),this.hoverDuration)},lock:function(){var settings=atheos.sidebars.settings;if(settings.leftLockedVisible){this.icon.replaceClass('fas fa-lock','fas fa-unlock')}else{this.icon.replaceClass('fas fa-unlock','fas fa-lock')}
settings.leftLockedVisible=!(settings.leftLockedVisible);atheos.storage('sidebars.leftLockedVisible',settings.leftLockedVisible)}},sbRight:{sidebar:null,handle:null,icon:null,timeoutOpen:null,timeoutClose:null,hoverDuration:300,init:function(){this.sidebar=oX('#sb-right');this.handle=oX('#sb-right-handle');this.icon=oX('#sb-right-lock');this.hoverDuration=atheos.storage('sidebars.hoverDuration')||300;this.icon.on('click',function(e){sidebars.sbRight.lock()});this.handle.on('mousedown',function(e){sidebars.resize(oX('#sb-right').el,'right')});this.handle.on('click',function(){if(sidebars.settings.rightOpenOnClick){sidebars.sbRight.open()}});this.sidebar.on('mouseout',function(){sidebars.sbRight.close()});this.sidebar.on('mouseover',function(){if(!sidebars.settings.rightOpenOnClick){sidebars.sbRight.open()}})},open:function(){var sidebarWidth=this.sidebar.clientWidth();if(this.sidebar.data&&this.sidebar.data.timeoutClose){clearTimeout(this.sidebar.data.timeoutClose)}
if(this.timeoutClose){clearTimeout(this.timeoutClose)}
this.timeoutOpen=setTimeout((function(){this.sidebar.css('right','0px');oX('#editor-region').css('margin-right',sidebarWidth+'px');setTimeout(function(){atheos.sidebars.settings.isRightSidebarOpen=!0;atheos.active.updateTabDropdownVisibility()},300)}).bind(this),this.hoverDuration)},close:function(){var sidebarWidth=this.sidebar.clientWidth(),sidebarHandleWidth=this.handle.clientWidth();if(this.timeoutOpen){clearTimeout(this.timeoutOpen)}
this.timeoutClose=setTimeout((function(){if(!atheos.sidebars.settings.rightLockedVisible){this.sidebar.css('right',-(sidebarWidth-sidebarHandleWidth)+'px');oX('#editor-region').css('margin-right','15px');setTimeout(function(){atheos.sidebars.settings.isRightSidebarOpen=!1;atheos.sidebars.sbRight.sidebar.trigger('h-resize-init');atheos.active.updateTabDropdownVisibility()},300)}}).bind(this),this.hoverDuration)},lock:function(){var settings=atheos.sidebars.settings;if(settings.rightLockedVisible){this.icon.replaceClass('fas fa-lock','fas fa-unlock')}else{this.icon.replaceClass('fas fa-unlock','fas fa-lock')}
settings.rightLockedVisible=!(settings.rightLockedVisible);atheos.storage('sidebars.rightLockedVisible',settings.rightLockedVisible)}},resize:function(sidebar,side){var rect=sidebar.getBoundingClientRect(),modalX=rect.left,editor=oX('#editor-region');function moveElement(event){if(sidebar!==null){var width;if(side==='left'){width=(modalX+event.clientX+10)}else{width=(window.innerWidth-event.clientX+10)}
sidebar.style.width=((width>14)?width:15)+'px';editor.css('margin-'+side,sidebar.clientWidth+'px');if(side==='right'){oX('#tab-close').style.marginRight=(sidebar.clientWidth-10)+'px';oX('#tab-dropdown').style.marginRight=(sidebar.clientWidth-10)+'px'}}}
function removeListeners(){setTimeout(function(){editor.css('margin-'+side,sidebar.clientWidth+'px')},200);var width=oX('#sb-'+side).clientWidth();width=width>14?width:15;atheos.storage('sidebars.sb-'+side+'-width',width);document.removeEventListener('mousemove',moveElement,!1);document.removeEventListener('mouseup',removeListeners,!1)}
document.addEventListener('mousemove',moveElement,!1);document.addEventListener('mouseup',removeListeners,!1)}}})(this);
// components/textmode/init.js
// components/textmode/init.js
(function(global){'use strict';var textmode=null;var atheos=global.atheos,amplify=global.amplify,ajax=global.ajax,oX=global.onyx;amplify.subscribe('atheos.loaded',()=>atheos.textmode.init());atheos.textmode={dialog:'components/textmode/dialog.php',controller:'components/textmode/controller.php',availableTextModes:[],init:function(){textmode=this;ajax({url:textmode.controller,type:'post',data:{'action':'getTextModes'},success:textmode.setEditorTextModes})},setEditorTextModes:function(data){data=JSON.parse(data);if(data.status!=='error'&&data.extensions!==undefined){atheos.editor.clearFileExtensionTextMode();for(var ext in data.extensions){atheos.editor.addFileExtensionTextMode(ext,data.extensions[ext])}
if(data.textModes!==undefined&&data.textModes!==[]){textmode.availableTextModes=data.textModes}
amplify.publish('textmode.loaded')}
atheos.toast[data.status](data.message)},saveExtensions:function(){var form=oX('#modal_content form').el;var len=form.elements.length;var data={'action':'setTextModes'};for(var i=0;i<len;i++){var field=form.elements[i];if(field.name!=='extension'&&field.name!=='textmode'){continue}
if(data[field.name]){data[field.name].push(field.value)}else{data[field.name]=[field.value]}}
ajax({url:textmode.controller,type:'post',data:data,success:textmode.setEditorTextModes})},addFieldToForm:function(){var extensions=oX('#textmodes');var code='<tr><td><input type="text" name="extension" value="" /></td>';code+='<td><select name="textMode">';textmode.availableTextModes.forEach(mode=>{code+='<option>'+mode+'</option>'});code+='</select></td></tr>';extensions.append(code)}}})(this);
// components/update/init.js
// components/update/init.js
(function(global){var atheos=global.atheos,amplify=global.amplify,ajax=global.ajax,o=global.onyx;amplify.subscribe('atheos.loaded',function(settings){atheos.update.init()});atheos.update={controller:'components/update/controller.php',dialog:'components/update/dialog.php',home:'https://www.atheos.io/update',repo:'https://api.github.com/repos/Atheos/Atheos/releases/latest',local:'',init:function(){var update=this;ajax({url:update.controller+'?action=init',success:function(data){update.local=JSON.parse(data)}});ajax({url:update.repo,success:function(data){update.remote=JSON.parse(data)}})},check:function(){atheos.modal.load(500,this.dialog+'?action=check')},download:function(){var archive=$('#modal_content form input[name="archive"]').val();o('#download').attr('src',archive);ajax({url:this.controller+'?action=clear',});atheos.modal.unload()}}})(this);
// components/user/init.js
// components/user/init.js
(function(global,$){var atheos=global.atheos,ajax=global.ajax,amplify=global.amplify,i18n=global.i18n,oX=global.onyx;amplify.subscribe('atheos.loaded',function(settings){atheos.user.init()});atheos.user={loginForm:oX('#login'),controller:'components/user/controller.php',dialog:'components/user/dialog.php',init:function(){var user=this;if(user.loginForm){user.loginForm.on('submit',function(e){e.preventDefault();atheos.storage('language',oX('#language').value());atheos.storage('theme',oX('#theme').value());user.authenticate()});var theme=atheos.storage('theme');var select=oX('#theme');if(select&&select.find('option')>1){select.find('option').forEach(function(option){if(option.value()===theme){console.log('found');option.attr('selected','selected')}})}
var language=atheos.storage('language');select=oX('#language');if(select&&select.find('option')>1){select.find('option').forEach(function(option){if(option.value()===language){option.attr('selected','selected')}})}
oX('#show_login_options').on('click',function(e){oX(e.target).hide();oX('#login_options').show()})}
amplify.subscribe('chrono.mega',function(){ajax({url:atheos.user.controller+'?action=verify',success:function(data){if(data==='false'){atheos.user.logout()}}})})},authenticate:function(){ajax({url:this.controller+'?action=authenticate',type:'post',data:atheos.common.serializeForm(this.loginForm.el),success:function(response){response=JSON.parse(response);if(response.status!=='error'){window.location.reload()}else{atheos.toast.error(response.message)}}})},logout:function(){var forcelogout=!0;var unsaved=oX('#list-active-files').find('li.changed');if(unsaved.length>0){forcelogout=confirm(i18n('You have unsaved files.'))}
if(forcelogout){unsaved.forEach(function(changed){changed.removeClass('changed')});amplify.publish('user.logout');atheos.settings.save();ajax({url:this.controller+'?action=logout',success:function(){window.location.reload()}})}},list:function(){atheos.modal.load(400,this.dialog+'?action=list')},createNew:function(){var user=this;atheos.modal.load(400,this.dialog+'?action=create');$('#modal_content form').live('submit',function(e){e.preventDefault();var pass=!0;var username=$('#modal_content form input[name="username"]').val();var password1=$('#modal_content form input[name="password1"]').val();var password2=$('#modal_content form input[name="password2"]').val();if(password1!==password2){atheos.toast.error(i18n('Passwords Do Not Match'));pass=!1}
if(!/^[a-z0-9]+$/i.test(username)||username.length===0){atheos.toast.error(i18n('Username Must Be Alphanumeric String'));pass=!1}
if(pass){$.post(user.controller+'?action=create',{'username':username,'password':password1},function(data){var createResponse=atheos.jsend.parse(data);if(createResponse!=='error'){atheos.toast.success(i18n('User Account Created'));user.list()}})}})},delete:function(username){var user=this;atheos.modal.load(400,this.dialog+'?action=delete&username='+username);$('#modal_content form').live('submit',function(e){e.preventDefault();var username=$('#modal-content form input[name="username"]').val();$.get(user.controller+'?action=delete&username='+username,function(data){var deleteResponse=atheos.jsend.parse(data);if(deleteResponse!=='error'){atheos.toast.success(i18n('Account Deleted'));user.list()}})})},showUserACL:function(username){atheos.modal.load(400,this.dialog+'?action=projects&username='+username);var user=this;atheos.modal.ready.then(function(){oX('#modal_content').on('submit',function(e){e.preventDefault();var data=atheos.common.serializeForm(oX('#modal_content form').el);data.action='setUserACL';if(data.access_level===0){data.projects=0}
if(data.access_level===1&&!data.projects){atheos.toast.error(i18n('At Least One Project Must Be Selected'))}else{ajax({url:user.controller,type:'post',data:data,success:function(data){atheos.modal.unload()}})}})})},password:function(username){var _this=this;atheos.modal.load(400,this.dialog+'?action=password&username='+username);$('#modal_content form').live('submit',function(e){e.preventDefault();var username=$('#modal_content form input[name="username"]').val();var password1=$('#modal_content form input[name="password1"]').val();var password2=$('#modal_content form input[name="password2"]').val();if(password1!==password2){atheos.toast.error(i18n('Passwords Do Not Match'))}else{$.post(_this.controller+'?action=password',{'username':username,'password':password1},function(data){var passwordResponse=atheos.jsend.parse(data);if(passwordResponse!=='error'){atheos.toast.success(i18n('Password Changed'));atheos.modal.unload()}})}})},saveActiveProject:function(project){ajax({url:this.controller,type:'post',data:{action:'saveActiveProject',project:project}})}}})(this,jQuery);
// components/worker/init.js
// components/worker/init.js
(function(global){var atheos=global.atheos;atheos.workerManager={taskQueue:[],addTask:function(taskConfig,callback,context){var _this=this;if(_this.worker!==null){this.taskQueue.push({config:taskConfig,callback:callback,context:context});this.clearSubsidableTasks(taskConfig.id);if(!this.workerRunning()){var initStatus=this.initiateWorker();if(!initStatus){callback(null,!1);return}
this.worker.addEventListener('message',function(e){_this.concludeTask(e.data)},!1)}
if(this.taskQueue.length===1){this.scheduleNext()}}else{callback(!1,taskConfig.id)}},workerRunning:function(){return!!this.worker},initiateWorker:function(){if(typeof Worker!=='undefined'&&Worker!==null){this.worker=new Worker('components/worker/worker.js');return!!this.worker}},clearSubsidableTasks:function(id){var i=this.taskQueue.length-2;while(i>0){if(this.taskQueue[i].id===id){this.taskQueue.splice(i,1)}
i--}},scheduleNext:function(){var taskConfig=this.taskQueue[0].config;this.worker.postMessage(taskConfig)},concludeTask:function(msg){if(this.taskQueue.length>0){var tq=this.taskQueue[0];var callback=tq.callback;context=tq.context;this.taskQueue.splice(0,1);if(this.taskQueue.length>0){this.scheduleNext()}
tq.callback.apply(context,[msg.success,msg.result])}}}})(this);
